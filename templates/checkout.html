{% extends "base.html" %}
{% block title %}Paiement - {{ course.title }}{% endblock %}
{% block content %}
  <!-- Section principale -->
  <section class="container mx-auto py-10 max-w-md">
    <h2 class="text-2xl font-bold mb-6">Paiement pour : {{ course.title }}</h2>

    {% if success %}
      <div class="bg-green-100 text-green-800 p-4 rounded mb-4">
        ✅ Paiement réussi ! Le lien du cours a été envoyé à votre email.
      </div>
    {% elif success is not none %}
      <div class="bg-red-100 text-red-800 p-4 rounded mb-4">
        ❌ Erreur lors de l'envoi : {{ error }}
      </div>
    {% endif %}

    <!-- Formulaire d'information -->
    <form method="POST" id="userForm" class="space-y-4">
      <input type="text" name="full_name" id="full_name" required placeholder="Nom complet" class="w-full p-2 border rounded">
      <input type="email" name="email" id="email" required placeholder="Email" class="w-full p-2 border rounded">
    </form>

    <!-- Bouton PayPal -->
    <div class="mt-6" id="paypal-button-container"></div>

    <script>
      paypal.Buttons({
        createOrder: function(data, actions) {
          return actions.order.create({
            purchase_units: [{
              amount: {
                value: '{{ course.price }}'
              }
            }]
          });
        },
        onApprove: function(data, actions) {
          return actions.order.capture().then(function(details) {
            fetch("/checkout/{{ course.id }}", {
              method: "POST",
              headers: {
                "Content-Type": "application/x-www-form-urlencoded"
              },
              body: new URLSearchParams({
                full_name: document.getElementById("full_name").value,
                email: document.getElementById("email").value,
                card_number: "paypal",
                expiry: "paypal",
                cvv: "paypal"
              })
            }).then(() => {
              window.location.reload();
            });
          });
        }
      }).render('#paypal-button-container');
    </script>
    <div class="advertisement">
        <!-- Emplacement pour la publicité -->
        <img src="https://via.placeholder.com/468x60?text=Publicité" alt="Publicité">
    </div>
  </section>
{% endblock %}